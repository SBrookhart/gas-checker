
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Multichain Gas Checker</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root {
    --bg: #0b0f14;
    --card: #111827;
    --border: #1f2937;
    --text: #e5e7eb;
    --muted: #94a3b8;
    --cheap: #065f46;
    --moderate: #854d0e;
    --expensive: #7f1d1d;
    --accent: #243041;
  }
  body { background: var(--bg); color: var(--text); font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; padding: 20px; }
  h1 { text-align: center; margin-bottom: 4px; }
  .meta { text-align:center; color: var(--muted); margin-bottom: 14px; }
  .grid { display:grid; gap:14px; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
  .card { background: var(--card); padding: 16px; border-radius: 12px; border:1px solid var(--border); min-height: 120px; display:flex; flex-direction:column; justify-content:space-between; }
  .card h2 { margin: 0 0 8px; font-size: 1.05rem; }
  .value { font-size: 1.5rem; margin: 6px 0; }
  .row { display:flex; justify-content:space-between; gap: 10px; align-items:center; }
  .badge { display:inline-block; padding: 4px 10px; border-radius: 999px; font-size: .8rem; text-transform: capitalize; }
  .cheap { background: var(--cheap); }
  .moderate { background: var(--moderate); }
  .expensive { background: var(--expensive); }
  .err { color:#fca5a5; font-size: .9rem; }
  button { background:#1f2937; color:var(--text); border:1px solid var(--border); padding:6px 10px; border-radius:8px; cursor:pointer; }
  button:hover { background:var(--accent); }
  details.debug { max-width: 980px; margin: 16px auto; background:#0f1620; border:1px solid var(--border); border-radius:10px; padding:8px 12px; }
  .log { white-space: pre-wrap; font-family: ui-monospace, Menlo, Consolas, monospace; font-size: 12px; color:#cbd5e1; max-height: 200px; overflow:auto; background:#0b1119; border:1px solid #1f2937; border-radius:8px; padding:8px; }
</style>
</head>

<body>
  <h1>⛽ Multichain Gas Checker</h1>
  <div class="meta">
    <span id="lastUpdated">Loading…</span>
    &middot; Auto‑refresh every 30s
    &middot; <button id="refreshBtn" title="Refresh now">Refresh</button>
  </div>

  <div id="root" class="grid"></div>

  <details class="debug">
    <summary>Debug (optional)</summary>
    <div class="log" id="debugLog">No logs yet.</div>
  </details>

<script>
/** ========= 1) CONFIG: Paste your free Etherscan API key here ========= **/
const ETHERSCAN_API_KEY = 'PASTE_YOUR_KEY_HERE'; // <-- replace this with your key

/** ========= Tiny debug logger ========= **/
const logEl = document.getElementById('debugLog');
function dlog(...args) {
  const line = args.map(a => (typeof a === 'object' ? JSON.stringify(a) : String(a))).join(' ');
  logEl.textContent += `\n${new Date().toLocaleTimeString()}  ${line}`;
  logEl.scrollTop = logEl.scrollHeight;
}

/** ========= Utilities ========= **/
function gasLevelFromGwei(g) {
  if (!isFinite(g)) return 'moderate';
  if (g <= 10) return 'cheap';
  if (g <= 30) return 'moderate';
  return 'expensive';
}
function niceTime(ts = Date.now()) { return new Date(ts).toLocaleTimeString(); }

async function fetchWithTimeout(url, options = {}, timeoutMs = 5000) {
  const ctrl = new AbortController();
  const id = setTimeout(() => ctrl.abort(), timeoutMs);
  try {
    const r = await fetch(url, { ...options, signal: ctrl.signal });
    if (!r.ok) throw new Error(`HTTP ${r.status}`);
    return r;
  } finally { clearTimeout(id); }
}

async function rpcPOST(url, method, params = [], timeoutMs = 5000) {
  const body = JSON.stringify({ jsonrpc: "2.0", id: 1, method, params });
  const r = await fetchWithTimeout(url, {
    method: 'POST',
    headers: { 'content-type': 'application/json' },
    body
  }, timeoutMs);
  const j = await r.json();
  if (j.error) throw new Error(j.error.message || 'RPC error');
  return j.result;
}

function toGweiFromHexWei(weiHex) {
  try { return parseInt(weiHex, 16) / 1e9; } catch { return NaN; }
}
function lamportsToSol(lamports) { return lamports / 1e9; }

/** ========= Chain Fetchers ========= **/

// ETH via Etherscan Gas Oracle (requires free key)
async function getEthereum() {
  if (!ETHERSCAN_API_KEY || ETHERSCAN_API_KEY === 'PASTE_YOUR_KEY_HERE') {
    return {
      chain: 'Ethereum',
      unit: 'gwei',
      value: NaN,
      level: 'moderate',
      error: 'Add your free Etherscan API key (see top of file).',
      link: 'https://docs.etherscan.io/api-reference/endpoint/gasoracle'
    };
  }
  const url = `https://api.etherscan.io/v2/api?chainid=1&module=gastracker&action=gasoracle&apikey=${encodeURIComponent(ETHERSCAN_API_KEY)}`;
  const r = await fetchWithTimeout(url, {}, 6000);
  const j = await r.json();
  if (j.status !== '1' || !j.result) throw new Error('Etherscan returned no data');
  const g = j.result;
  // ProposeGasPrice is already in Gwei (string)
  const propose = parseFloat(g.ProposeGasPrice);
  return { chain: 'Ethereum', unit: 'gwei', value: propose, level: gasLevelFromGwei(propose) };
}

// Polygon — Gas Station (no key)
async function getPolygon() {
  const r = await fetchWithTimeout('https://gasstation.polygon.technology/v2', {}, 6000);
  const g = await r.json();
  const propose = g?.standard?.maxFee ?? g?.standard?.suggestedMaxFee ?? g?.fast?.maxFee ?? 0;
  return { chain: 'Polygon', unit: 'gwei', value: propose, level: gasLevelFromGwei(propose) };
}

// Arbitrum — public RPC
async function getArbitrum() {
  const gasPriceWeiHex = await rpcPOST('https://arb1.arbitrum.io/rpc', 'eth_gasPrice', [], 6000);
  const propose = toGweiFromHexWei(gasPriceWeiHex);
  return { chain: 'Arbitrum', unit: 'gwei', value: propose, level: gasLevelFromGwei(propose) };
}

// Optimism — public RPC
async function getOptimism() {
  const gasPriceWeiHex = await rpcPOST('https://mainnet.optimism.io', 'eth_gasPrice', [], 6000);
  const propose = toGweiFromHexWei(gasPriceWeiHex);
  return { chain: 'Optimism', unit: 'gwei', value: propose, level: gasLevelFromGwei(propose) };
}

// Base — public RPC (this one worked for you)
async function getBase() {
  const gasPriceWeiHex = await rpcPOST('https://mainnet.base.org', 'eth_gasPrice', [], 6000);
  const propose = toGweiFromHexWei(gasPriceWeiHex);
  return { chain: 'Base', unit: 'gwei', value: propose, level: gasLevelFromGwei(propose) };
}

// Avalanche — public RPC
async function getAvalanche() {
  const gasPriceWeiHex = await rpcPOST('https://api.avax.network/ext/bc/C/rpc', 'eth_gasPrice', [], 6000);
  const propose = toGweiFromHexWei(gasPriceWeiHex);
  return { chain: 'Avalanche', unit: 'gwei', value: propose, level: gasLevelFromGwei(propose) };
}

// Solana — public RPC with quick fallback
async function getSolana() {
  try {
    // Prefer getRecentPrioritizationFees, then fall back to getFees
    let lamportsPerSig = 5000;
    try {
      const fees = await rpcPOST('https://api.mainnet-beta.solana.com', 'getRecentPrioritizationFees', [], 5000);
      const arr = Array.isArray(fees) ? fees : [];
      const priors = arr.map(x => x?.prioritizationFee).filter(n => typeof n === 'number' && n >= 0);
      const median = priors.length ? priors.sort((a,b)=>a-b)[Math.floor(priors.length/2)] : 0;
      lamportsPerSig += median;
    } catch {
      const feesObj = await rpcPOST('https://api.mainnet-beta.solana.com', 'getFees', [], 5000);
      if (feesObj?.value?.feeCalculator?.lamportsPerSignature) {
        lamportsPerSig = feesObj.value.feeCalculator.lamportsPerSignature;
      }
    }
    const sol = lamportsToSol(lamportsPerSig);
    return { chain: 'Solana', unit: 'SOL/tx', value: sol, level: 'cheap' };
  } catch {
    // safe static estimate
    return { chain: 'Solana', unit: 'SOL/tx', value: 0.000005, level: 'cheap', note: 'est' };
  }
}

/** ========= Rendering ========= **/
function renderCards(results) {
  const root = document.getElementById('root');
  const html = results.map(r => {
    if (!r) return '';
    // ETH fallback card with link if key missing or blocked
    if (r.chain === 'Ethereum' && (r.error || !isFinite(r.value))) {
      return `
        <div class="card">
          <div class="row"><h2>${r.chain}</h2><span class="badge ${r.level}">${r.level}</span></div>
          <div class="value">—</div>
          <div class="err" style="margin-bottom:8px;">${r.error || 'Unavailable'}</div>
          <div>
            <a href="${r.link || 'https://etherscan.io/gastracker'}" target="_blank" rel="noopener">
              <button>Open Etherscan Gas Tracker</button>
            </a>
          </div>
          <div class="row" style="color: var(--muted); font-size:.9rem; margin-top:8px;">
            <span>Partial fallback shown</span><span>${niceTime()}</span>
          </div>
        </div>
      `;
    }

    if (r.error) {
      return `
        <div class="card">
          <h2>${r.chain}</h2>
          <div class="value">—</div>
          <div class="err">${r.error}</div>
        </div>
      `;
    }

    const valueStr = r.unit === 'gwei'
      ? (isFinite(r.value) ? `${r.value.toFixed(1)} gwei` : '—')
      : `~${r.value.toFixed(6)} ${r.unit}${r.note ? ' (est)' : ''}`;

    return `
      <div class="card">
        <div class="row"><h2>${r.chain}</h2><span class="badge ${r.level}">${r.level}</span></div>
        <div class="value">${valueStr}</div>
        <div class="row" style="color: var(--muted); font-size:.9rem">
          <span>Live estimate</span><span>${niceTime()}</span>
        </div>
      </div>
    `;
  }).join('');
  root.innerHTML = html;
}

async function loadAll() {
  const fetchers = [
    () => getEthereum().catch(e => ({ chain:'Ethereum', error: e.message })),
    () => getPolygon().catch(e => ({ chain:'Polygon', error: e.message })),
    () => getArbitrum().catch(e => ({ chain:'Arbitrum', error: e.message })),
    () => getOptimism().catch(e => ({ chain:'Optimism', error: e.message })),
    () => getBase().catch(e => ({ chain:'Base', error: e.message })),
    () => getAvalanche().catch(e => ({ chain:'Avalanche', error: e.message })),
    () => getSolana().catch(e => ({ chain:'Solana', error: e.message })),
  ];
  const results = await Promise.all(fetchers.map(fn => fn()));
  renderCards(results);
  document.getElementById('lastUpdated').textContent = `Last updated: ${niceTime()}`;
}

// Init + auto refresh
loadAll();
setInterval(loadAll, 30_000);
document.getElementById('refreshBtn').addEventListener('click', loadAll);
</script>
</body>
</html>
``
